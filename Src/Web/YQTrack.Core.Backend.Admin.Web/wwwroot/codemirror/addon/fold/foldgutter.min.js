(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("./foldcode")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./foldcode"],n):n(CodeMirror)})(function(n){"use strict";function c(n){this.options=n;this.from=this.to=0}function l(n){return n===!0&&(n={}),n.gutter==null&&(n.gutter="CodeMirror-foldgutter"),n.indicatorOpen==null&&(n.indicatorOpen="CodeMirror-foldgutter-open"),n.indicatorFolded==null&&(n.indicatorFolded="CodeMirror-foldgutter-folded"),n}function e(n,i){for(var u=n.findMarks(t(i,0),t(i+1,0)),r=0;r<u.length;++r)if(u[r].__isFold&&u[r].find().from.line==i)return u[r]}function o(n){if(typeof n=="string"){var t=document.createElement("div");return t.className=n+" CodeMirror-guttermarker-subtle",t}return n.cloneNode(!0)}function i(n,i,r){var u=n.state.foldGutter.options,f=i,h=n.foldOption(u,"minFoldSize"),s=n.foldOption(u,"rangeFinder");n.eachLine(i,r,function(i){var c=null,l,r;e(n,f)?c=o(u.indicatorFolded):(l=t(f,0),r=s&&s(n,l),r&&r.to.line-r.from.line>=h&&(c=o(u.indicatorOpen)));n.setGutterMarker(i,u.gutter,c);++f})}function f(n){var t=n.getViewport(),r=n.state.foldGutter;r&&(n.operation(function(){i(n,t.from,t.to)}),r.from=t.from,r.to=t.to)}function s(n,i,r){var o=n.state.foldGutter,u,f;o&&(u=o.options,r==u.gutter)&&(f=e(n,i),f?f.clear():n.foldCode(t(i,0),u.rangeFinder))}function r(n){var t=n.state.foldGutter,i;t&&(i=t.options,t.from=t.to=0,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){f(n)},i.foldOnChangeTimeSpan||600))}function h(n){var t=n.state.foldGutter,r;t&&(r=t.options,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){var r=n.getViewport();t.from==t.to||r.from-t.to>20||t.from-r.to>20?f(n):n.operation(function(){r.from<t.from&&(i(n,r.from,t.from),t.from=r.from);r.to>t.to&&(i(n,t.to,r.to),t.to=r.to)})},r.updateViewportTimeSpan||400))}function u(n,t){var u=n.state.foldGutter,r;u&&(r=t.line,r>=u.from&&r<u.to&&i(n,r,r+1))}n.defineOption("foldGutter",!1,function(t,i,e){if(e&&e!=n.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",s),t.off("change",r),t.off("viewportChange",h),t.off("fold",u),t.off("unfold",u),t.off("swapDoc",r)),i){t.state.foldGutter=new c(l(i));f(t);t.on("gutterClick",s);t.on("change",r);t.on("viewportChange",h);t.on("fold",u);t.on("unfold",u);t.on("swapDoc",r)}});var t=n.Pos});