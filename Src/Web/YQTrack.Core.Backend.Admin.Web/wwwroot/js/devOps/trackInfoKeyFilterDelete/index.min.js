layui.config({base:"/module/"}).extend({treetable:"treetable-lay/treetable"}).use(["form","layer","table","treetable","laytpl"],function(){function r(){var r=n("#table tbody"),u="";r.html()!=""&&(u=r.find("td:first").text());n.get("/DevOps/TrackInfoKeyFilterDelete/GetBatchDeleteState?key="+u,function(u){if(!u.success)return t.alert("操作失败:"+u.msg,{title:"错误",icon:5}),!1;u.data.item2.batchDeleteKeys.forEach(function(n){r.prepend("<tr><td>"+n+"<\/td><\/tr>")});u.data.item1&&(t.alert("操作成功:"+u.data.item2.msg,{title:"提示",icon:6}),clearInterval(i),n("#batchDel").show(),n("#scanning").hide(),n("#cancel").hide())})}var n=layui.jquery,t=parent.layer===undefined?layui.layer:top.layer,u=layui.table,f=top.initFilter(window),i;n("#batchDel").click(function(){top.changeUrlParam(window);var u=n.trim(n("#filter").val());return u.length<4?(t.msg("缓存键匹配规则不能少于四个字符"),!1):(t.confirm("确认要删除模糊匹配“"+u+"”的缓存吗？",{icon:3,title:"提示"},function(f){t.close(f);n("#batchDel").hide();n("#scanning").show();n("#cancel").show();n("#table tbody").html("");n.get("/DevOps/TrackInfoKeyFilterDelete/BatchDelete?filter="+u,function(n){if(!n.success)return t.alert("操作失败:"+n.msg,{title:"错误",icon:5}),!1;layui.layer.msg("任务已启动");i=setInterval(r,1e3)})}),!1)});n("#cancel").click(function(){var i=n("#filter").val();return t.confirm("确认要取消删除模糊匹配“"+i+"”的缓存吗？",{icon:3,title:"提示"},function(i){t.close(i);var r=t.load(0,{shade:[.3,"#fff"]});n.get("/DevOps/TrackInfoKeyFilterDelete/CancelBatchDelete",function(n){if(t.close(r),!n.success)return t.alert("操作失败:"+n.msg,{title:"错误",icon:5}),!1;layui.layer.msg("操作成功")})}),!1});i=null;n("#batchDel").css("display")=="none"&&(i=setInterval(r,1e3))});