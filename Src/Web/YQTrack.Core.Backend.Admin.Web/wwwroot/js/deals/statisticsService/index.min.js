layui.use(["element","laydate","form","layer","table","laytpl"],function(){function f(n,t){return t<0?n+'(<span style="color: #00cc00;">'+t+"%<\/span>) ":n+'(<span style="color: #cc0000;">'+t+"%<\/span>) "}function y(){o.showLoading();n.post("/Deals/StatisticsService/GetStatisticsListData",{startTime:n("#startTime").val(),endTime:n("#endTime").val()},function(t){if(!t.success){e.alert("操作失败:"+t.msg,{title:"错误",icon:5});return}let i=t.data;var f=n.extend({},r,{title:{text:i.clickRate.title},legend:{data:n.map(i.clickRate.series,function(n){return n.name})},xAxis:{data:i.clickRate.xAxisData},series:i.clickRate.series}),s=n.extend({},r,{title:{text:i.transactionRate.title},legend:{data:n.map(i.transactionRate.series,function(n){return n.name})},xAxis:{data:i.transactionRate.xAxisData},series:i.transactionRate.series}),y=n.extend({},r,{title:{text:i.paymentRate.title},legend:{data:n.map(i.paymentRate.series,function(n){return n.name})},xAxis:{data:i.paymentRate.xAxisData},series:i.paymentRate.series}),p=n.extend({},r,{title:{text:i.conversionRate.title},legend:{data:n.map(i.conversionRate.series,function(n){return n.name})},xAxis:{data:i.conversionRate.xAxisData},series:i.conversionRate.series}),w=n.extend({},r,{title:{text:i.ecpcRate.title},legend:{data:n.map(i.ecpcRate.series,function(n){return n.name})},xAxis:{data:i.ecpcRate.xAxisData},series:i.ecpcRate.series}),b=n.extend({},r,{title:{text:i.allRate.title},legend:{data:n.map(i.allRate.series,function(n){return n.name})},xAxis:{data:i.allRate.xAxisData},series:i.allRate.series});o.hideLoading();h.hideLoading();c.hideLoading();l.hideLoading();a.hideLoading();v.hideLoading();u(o,f);u(h,s);u(c,y);u(l,p);u(a,w);u(v,b)})}function u(n,t){n.setOption(t)}var p=layui.form,e=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery,w=layui.laytpl,t=layui.table,s=layui.laydate,b=layui.element,i=new Date;i=i.setDate(i.getDate()-90);i=new Date(i);s.render({elem:"#startTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",value:i,calendar:!0,done:function(t){var i=n("#endTime").val();i&&t>i&&(e.alert("开始日期不能大于结束日期"),n("#startTime").val(""))}});s.render({elem:"#endTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",value:new Date,calendar:!0,done:function(t){var i=n("#startTime").val();i&&t<i&&(e.alert("开始日期不能大于结束日期"),n("#endTime").val(""))}});var o=echarts.init(document.getElementById("statisticsAllChartFromClickRate"),"shine"),h=echarts.init(document.getElementById("statisticsAllChartFromTransactionRate"),"shine"),c=echarts.init(document.getElementById("statisticsAllChartFromPaymentRate"),"shine"),l=echarts.init(document.getElementById("statisticsAllChartFromConversionRate"),"shine"),a=echarts.init(document.getElementById("statisticsAllChartFromECPCRate"),"shine"),v=echarts.init(document.getElementById("statisticsAllChartFromAllRate"),"shine"),r={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross",crossStyle:{color:"#999"}}},toolbox:{feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},legend:{data:[]},xAxis:[{type:"category",data:[],axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"数量",min:0}],series:[]};t.render({elem:"#tableStatisticsAll",method:"post",url:"/Deals/StatisticsService/GetStatisticsContrastData",page:!1,cellMinWidth:60,cols:[[{type:"numbers"},{field:"clickCount",title:"点击",templet:function(n){return f(n.clickCount,n.clickRate)}},{field:"transactionCount",title:"交易",templet:function(n){return f(n.transactionCount,n.transactionRate)}},{field:"paymentCount",title:"佣金",templet:function(n){return f(n.paymentCount,n.paymentRate)}},{field:"conversion",title:"转化率",templet:function(n){return f(n.conversion,n.conversionRate)}},{field:"ecpc",title:"ECPC",templet:function(n){return f(n.ecpc,n.ecpcRate)}},{field:"statisticsDate",title:"统计时间"}]],where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}});t.render({elem:"#tableStartMer",method:"post",url:"/Deals/StatisticsService/GetStatisticsMerStartData",page:!1,cellMinWidth:60,cols:[[{type:"numbers"},{field:"statisticsDate",title:"统计时间"},{field:"prioritys",title:"顺序",width:70},{field:"yqMerchantLibraryId",title:"广告商"},{field:"name",title:"广告商名称"},{field:"clickCount",title:"点击",width:70},{field:"transactionCount",title:"转化",width:70},{field:"paymentCount",title:"佣金",width:70},{field:"conversion",title:"转化率",width:80},{field:"ecpc",title:"ECPC",width:70}]],where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}});t.render({elem:"#tableEndMer",method:"post",url:"/Deals/StatisticsService/GetStatisticsMerEndData",page:!1,cellMinWidth:60,cols:[[{type:"numbers"},{field:"statisticsDate",title:"统计时间"},{field:"prioritys",title:"顺序",width:70},{field:"yqMerchantLibraryId",title:"广告商"},{field:"name",title:"广告商名称"},{field:"clickCount",title:"点击",width:70},{field:"transactionCount",title:"转化",width:70},{field:"paymentCount",title:"佣金",width:70},{field:"conversion",title:"转化率",width:80},{field:"ecpc",title:"ECPC",width:70}]],where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}});y();n("#search").on("click",function(){return y(),t.reload("tableStatisticsAll",{page:{curr:1},where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}}),t.reload("tableStartMer",{page:{curr:1},where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}}),t.reload("tableEndMer",{page:{curr:1},where:{startTime:n("#startTime").val(),endTime:n("#endTime").val()}}),!0})});