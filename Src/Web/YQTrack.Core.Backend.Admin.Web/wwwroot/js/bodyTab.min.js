window.localStorage.setItem("changeRefresh",window.localStorage.getItem("changeRefresh")==null?"true":window.localStorage.getItem("changeRefresh"));var tabFilter,menu=[],liIndex,curNav,delMenu,changeRefreshStr=window.localStorage.getItem("changeRefresh");layui.define(["element","jquery"],function(n){var r=layui.element,t=layui.$,e,i=function(){this.tabConfig={openTabNum:undefined,tabFilter:"bodyTab",url:undefined}},f,u;i.prototype.navBar=function(n){var i,r,t,u;for(i=typeof n=="string"?JSON.parse(n):n,r="",t=0;t<i.length;t++){if(r+=i[t].spread||i[t].spread===undefined?'<li class="layui-nav-item layui-nav-itemed">':'<li class="layui-nav-item">',i[t].children!=undefined&&i[t].children.length>0){for(r+="<a>",i[t].icon!=undefined&&i[t].icon!=""&&(r+=i[t].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].icon+'" data-icon="'+i[t].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].icon+'">'+i[t].icon+"<\/i>"),r+="<cite>"+i[t].title+"<\/cite>",r+='<span class="layui-nav-more"><\/span>',r+="<\/a>",r+='<dl class="layui-nav-child">',u=0;u<i[t].children.length;u++)r+=i[t].children[u].target=="_blank"?'<dd><a data-url="'+i[t].children[u].href.toLowerCase()+'" target="'+i[t].children[u].target+'">':'<dd><a data-url="'+i[t].children[u].href.toLowerCase()+'">',i[t].children[u].icon!=undefined&&i[t].children[u].icon!=""&&(r+=i[t].children[u].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].children[u].icon+'" data-icon="'+i[t].children[u].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].children[u].icon+'">'+i[t].children[u].icon+"<\/i>"),r+="<cite>"+i[t].children[u].title+"<\/cite><\/a><\/dd>";r+="<\/dl>"}else r+=i[t].target=="_blank"?'<a data-url="'+i[t].href.toLowerCase()+'" target="'+i[t].target+'">':'<a data-url="'+i[t].href.toLowerCase()+'">',i[t].icon!=undefined&&i[t].icon!=""&&(r+=i[t].icon.indexOf("icon-")!=-1?'<i class="seraph '+i[t].icon+'" data-icon="'+i[t].icon+'"><\/i>':'<i class="layui-icon" data-icon="'+i[t].icon+'">'+i[t].icon+"<\/i>"),r+="<cite>"+i[t].title+"<\/cite><\/a>";r+="<\/li>"}return r};i.prototype.render=function(){var n=this;t(".navBar ul").html('<li class="layui-nav-item layui-this"><a data-url="/home/main"><i class="layui-icon" data-icon=""><\/i><cite>我的首页<\/cite><\/a><\/li>').append(n.navBar(dataStr)).height(t(window).height()-210);r.init();t(window).resize(function(){t(".navBar").height(t(window).height()-210)})};i.prototype.changeRegresh=function(n,i,r,u){var e,f;r=="true"&&(e=t(".clildFrame .layui-tab-item").eq(n).find("iframe")[0].contentWindow.location.href,e!=i&&i?t(".clildFrame .layui-tab-item").eq(n).find("iframe")[0].contentWindow.location.href=i:t(".clildFrame .layui-tab-item").eq(n).find("iframe")[0].contentWindow.location.reload(),f=t("#top_tabs li").eq(n).find("cite").text(),u&&f!=u&&(f=t("#top_tabs li").eq(n).find("cite").text(u)))};i.prototype.set=function(n){var i=this;return t.extend(!0,i.tabConfig,n),i};i.prototype.getLayId=function(n){return t(".layui-tab-title.top_tab li").each(function(){t(this).find("cite").attr("name")==n&&(e=t(this).attr("lay-id"))}),e};i.prototype.getLayIndex=function(n){var i=-1;return t(".layui-tab-title.top_tab li").each(function(r){if(t(this).find("cite").attr("name")==n)return i=r}),i};i.prototype.hasTab=function(n){var i=-1;return t(".layui-tab-title.top_tab li").each(function(){t(this).find("cite").attr("name")==n&&(i=1)}),i};f=1;i.prototype.tabAdd=function(n){var i,c,o,h,e;if(window.sessionStorage.getItem("menu")&&(menu=JSON.parse(window.sessionStorage.getItem("menu"))),i=this,c=i.tabConfig.openTabNum,tabFilter=i.tabConfig.tabFilter,n.attr("target")==="_blank")window.open(n.attr("data-url"));else if(n.attr("data-url")!==undefined){o="";n.find("i.seraph,i.layui-icon").attr("data-icon")!=undefined&&(o+=n.find("i.seraph").attr("data-icon")!=undefined?'<i class="seraph '+n.find("i.seraph").attr("data-icon")+'"><\/i>':'<i class="layui-icon">'+n.find("i.layui-icon").attr("data-icon")+"<\/i>");var l=n.attr("data-url").split("?")[0].split("/"),s=encodeURI(n.attr("data-url")),u=l.join("");if(i.hasTab(u)===-1&&n.siblings("dl.layui-nav-child").length==0){if(t(".layui-tab-title.top_tab li").length===c){layer.msg("只能同时打开"+c+"个选项卡哦。不然系统会卡的！");return}f++;o+='<cite name="'+u+'">'+n.find("cite").text()+"<\/cite>";o+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+f+'">&#x1006;<\/i>';r.tabAdd(tabFilter,{title:o,content:'<iframe name="'+u+'" src="'+s+'" data-id="'+f+'"><\/iframe>',id:(new Date).getTime()});e={icon:n.find("i.seraph").attr("data-icon")!=undefined?n.find("i.seraph").attr("data-icon"):n.find("i.layui-icon").attr("data-icon"),title:n.find("cite").text(),name:u,href:s,layId:(new Date).getTime(),topMenuName:n.attr("topMenuName"),leftMenuName:n.attr("leftMenuName")};menu.push(e);window.sessionStorage.setItem("menu",JSON.stringify(menu));window.sessionStorage.setItem("curmenu",JSON.stringify(e));r.tabChange(tabFilter,i.getLayId(u));i.tabMove()}else h=i.getLayIndex(u),e={icon:n.find("i.seraph").attr("data-icon")!=undefined?n.find("i.seraph").attr("data-icon"):n.find("i.layui-icon").attr("data-icon"),title:n.find("cite").text(),name:u,href:s,layId:menu[h].layId,topMenuName:n.attr("topMenuName"),leftMenuName:n.attr("leftMenuName")},i.changeRegresh(h,e.href,"true",n.find("cite").text()),menu[h]=e,window.sessionStorage.setItem("curmenu",JSON.stringify(e)),window.sessionStorage.setItem("menu",JSON.stringify(menu)),r.tabChange(tabFilter,i.getLayId(u)),i.tabMove();window.location.href=window.location.href.split("#")[0]+"#/"+n.attr("topMenuName")+s}};i.prototype.tabMove=function(){t(window).on("resize",function(n){var a=t("#top_tabs_box"),u=t("#top_tabs_box").width(),i=t("#top_tabs"),f=t("#top_tabs").width(),o=i.find("li.layui-this"),l=document.getElementById("top_tabs"),n=n||window.event,e,s,h,c,r;if(f>u){o.position().left>u||o.position().left+u>f?i.css("left",u-f):i.css("left",-o.position().left);e=!1;s={x:0,y:0};function down(n){e=!0;var t;t=n.touches?n.touches[0]:n;s.x=t.clientX;c=l.offsetLeft}function move(n){var i=this,t;e&&(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),t=n.touches?n.touches[0]:n,h=t.clientX-s.x,r=c+h,r=r>0?0:r<u-f?u-f:c+h,l.style.left=r+"px",document.addEventListener("touchmove",function(){n.preventDefault()},!1))}function end(){e=!1}i.on("mousedown",down);i.on("mousemove",move);t(document).on("mouseup",end);i.on("touchstart",down);i.on("touchmove",move);i.on("touchend",end)}else return i.off("mousedown",down),i.off("mousemove",move),i.off("mouseup",end),i.off("touchstart",down),i.off("touchmove",move),i.off("touchend",end),i.removeAttr("style"),!1}).resize()};t("body").on("click",".top_tab li",function(){var n="",f=JSON.parse(window.sessionStorage.getItem("menu")),e=t(this).index(),i;window.sessionStorage.getItem("menu")&&(n=f[e]);window.sessionStorage.setItem("curmenu",JSON.stringify(n));window.sessionStorage.getItem("curmenu")=="undefined"&&(curNav!=JSON.stringify(delMenu)?(window.sessionStorage.setItem("curmenu",curNav),n=JSON.parse(curNav)):window.sessionStorage.setItem("curmenu",JSON.stringify(f[liIndex])));r.tabChange(tabFilter,t(this).attr("lay-id")).init();n&&(i=window.location.href,i.indexOf("#")>-1&&(i=i.split("#")[0]),window.location.href=i+"#/"+n.topMenuName+n.href,u.changeRegresh(t(this).index(),n.href,changeRefreshStr),topMenuName=n.topMenuName,top.positionMenu(n));setTimeout(function(){u.tabMove()},100)});t("body").on("click",".top_tab li i.layui-tab-close",function(){var n,i;liIndex=t(this).parent("li").index();n=JSON.parse(window.sessionStorage.getItem("menu"));n!=null&&(delMenu=n[liIndex],i=window.sessionStorage.getItem("curmenu")=="undefined"?undefined:window.sessionStorage.getItem("curmenu")==""?"":JSON.parse(window.sessionStorage.getItem("curmenu")),i.name!=delMenu.name?curNav=JSON.stringify(i):t(this).parent("li").length>liIndex?(curNav=i,window.sessionStorage.setItem("curmenu",JSON.stringify(i))):(curNav=JSON.stringify(n[liIndex-1]),window.sessionStorage.setItem("curmenu",JSON.stringify(curNav))),n.splice(liIndex,1),liIndex--,window.sessionStorage.setItem("menu",JSON.stringify(n)));r.tabDelete("bodyTab",t(this).parent("li").attr("lay-id")).init();u.tabMove()});t(".refresh").on("click",function(){return t(this).hasClass("refreshThis")?(t(this).removeClass("refreshThis"),t(".clildFrame .layui-tab-item.layui-show").find("iframe")[0].contentWindow.location.reload(),setTimeout(function(){t(".refresh").addClass("refreshThis")},2e3)):layer.msg("您点击的速度超过了服务器的响应速度，还是等两秒再刷新吧！"),!1});t(".closePageOther").on("click",function(){if(t("#top_tabs li").length>2&&t("#top_tabs li.layui-this cite").text()!="我的首页"){var n=JSON.parse(window.sessionStorage.getItem("menu"));t("#top_tabs li").each(function(){if(t(this).attr("lay-id")!=""&&!t(this).hasClass("layui-this")){r.tabDelete("bodyTab",t(this).attr("lay-id")).init();for(var i=1;i<n.length;i++)t("#top_tabs li.layui-this cite").text()==n[i].title&&(n.splice(1,n.length,n[i]),window.sessionStorage.setItem("menu",JSON.stringify(n)))}})}else t("#top_tabs li.layui-this cite").text()=="我的首页"&&t("#top_tabs li").length>1?t("#top_tabs li").each(function(){t(this).attr("lay-id")==""||t(this).hasClass("layui-this")||(r.tabDelete("bodyTab",t(this).attr("lay-id")).init(),n.splice(1,n.length),window.sessionStorage.setItem("menu",JSON.stringify(n)))}):layer.msg("没有可以关闭的窗口了@_@");return tab.tabMove(),!1});t(".closePageAll").on("click",function(){if(t("#top_tabs li").length>1){var n=JSON.parse(window.sessionStorage.getItem("menu"));t("#top_tabs li").each(function(){t(this).attr("lay-id")!=""&&(r.tabDelete("bodyTab",t(this).attr("lay-id")).init(),n.length>1&&(n.splice(1,n.length),window.sessionStorage.setItem("menu",JSON.stringify(n)),window.sessionStorage.setItem("curmenu",JSON.stringify(n[0]))))})}else layer.msg("没有可以关闭的窗口了@_@");return tab.tabMove(),location.href="/",!1});u=new i;n("bodyTab",function(n){return u.set(n)})});