layui.config({base:"/module/"}).extend({treeGrid:"authtree"}).use(["layer","authtree","jquery","form","code","laytpl"],function(){var t=layui.form,n=layui.jquery,i=parent.layer===undefined?layui.layer:top.layer,u=layui.laytpl,r=layui.authtree;t.verify({fullName:function(t){if(n("#multiPower").prop("checked")&&t=="")return"请输入唯一的权限代码"}});n("input[name=fullName]").focus(function(){if(!n("#multiPower").prop("checked")){var t=n("input[name=areaName]").val(),i=n("input[name=controllerName]").val(),r=n("input[name=actionName]").val();n(this).val(t+"_"+i+"_"+r)}});n("input[name=url]").focus(function(){var i=n("input[name=areaName]").val(),r=n("input[name=controllerName]").val(),u=n("input[name=actionName]").val(),t="";n("#multiPower").prop("checked")&&(t="?permissionCode="+n("input[name=fullName]").val());n(this).val("/"+i+"/"+r+"/"+u+t)});n.ajax({url:"/Admin/Permission/GetAll",method:"get",dataType:"json",success:function(i){var e=r.listConvert(i.data,{primaryKey:"id",startPid:-1,parentKey:"parentId",nameKey:"name",valueKey:"id",checkedKey:[],disabledKey:[]}),f,o;console.log(e);f=r.treeConvertSelect(e,{childKey:"list"});console.log(f);o=u(n("#LAY-auth-tree-convert-select").html()).render({layFilter:"LAY-auth-tree-convert-select-input",list:f,code:JSON.stringify(i,null,2)});n("#LAY-auth-tree-convert-select-dom").html(o);t.render("select");t.on("select(LAY-auth-tree-convert-select-input)",function(n){console.log("选中信息",n)})}});t.on("submit(formAdd)",function(t){return n.post("/Admin/Permission/Add",t.field,function(t){return t.success?(i.msg("操作成功",{icon:6}),top.refreshParent(),n("#close").click(),!1):(i.alert("操作失败:"+t.msg,{title:"错误",icon:5}),!1)}),!1});n("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)})});