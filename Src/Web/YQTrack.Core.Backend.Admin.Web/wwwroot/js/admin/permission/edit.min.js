layui.config({base:"/module/"}).extend({treeGrid:"authtree"}).use(["layer","authtree","jquery","form","code","laytpl"],function(){var t=layui.form,n=layui.jquery,i=parent.layer===undefined?layui.layer:top.layer,f=layui.laytpl,r=layui.authtree,u;t.verify({fullName:function(t){if(n("#multiPower").prop("checked")&&t=="")return"请输入唯一的权限代码"}});n("input[name=fullName]").focus(function(){if(!n("#multiPower").prop("checked")){var t=n("input[name=areaName]").val(),i=n("input[name=controllerName]").val(),r=n("input[name=actionName]").val();n(this).val(t+"_"+i+"_"+r)}});n("input[name=url]").focus(function(){var i=n("input[name=areaName]").val(),r=n("input[name=controllerName]").val(),u=n("input[name=actionName]").val(),t="";n("#multiPower").prop("checked")&&(t="?permissionCode="+n("input[name=fullName]").val());n(this).val("/"+i+"/"+r+"/"+u+t)});n.ajax({url:"/Admin/Permission/GetAll",method:"get",dataType:"json",success:function(i){var o=parseInt(n("#parentId").val()),u,e,s;console.log(o);u=r.listConvert(i.data,{primaryKey:"id",startPid:-1,parentKey:"parentId",nameKey:"name",valueKey:"id",checkedKey:[o],disabledKey:[]});console.log(u);e=r.treeConvertSelect(u,{childKey:"list"});console.log(e);s=f(n("#LAY-auth-tree-convert-select").html()).render({layFilter:"LAY-auth-tree-convert-select-input",list:e,code:JSON.stringify(i,null,2)});n("#LAY-auth-tree-convert-select-dom").html(s);t.render("select");t.on("select(LAY-auth-tree-convert-select-input)",function(n){console.log("选中信息",n)})}});u=parseInt(n("#menuType").val());n("select").val(u);t.on("submit(formEdit)",function(t){return t.field.parentId==="-1"&&(t.field.parentId=""),n.post("/Admin/Permission/Edit",t.field,function(t){return t.success?(i.msg("操作成功",{icon:6}),top.refreshParent(),n("#close").click(),!1):(i.alert("操作失败:"+t.msg,{title:"错误",icon:5}),!1)}),!1});n("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)})});