layui.use(["form","layer","table","laytpl"],function(){var u=layui.form,n=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,f=layui.laytpl,r=layui.table,t=top.initFilter(window);r.render({elem:"#roleTable",method:"post",url:"/Admin/Role/GetPageData",height:"full-"+t.top,cellMinWidth:90,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"id",title:"角色ID",hide:!0},{field:"name",title:"角色名称"},{field:"isActive",title:"是否启用",templet:"#isActive",width:100},{field:"remark",title:"备注"},{field:"createdTime",title:"创建时间",width:160},{field:"updatedTime",title:"更新时间",width:160}]],parseData:function(n){return n.success?n:{code:0,msg:n.msg,count:0,data:[],success:!1}},page:{limit:t.limit?t.limit:10,limits:[10,15,20,25],curr:t.page?t.page:1},where:{name:t.name},done:function(t,r){i("#page").val(r);i("#limit").val(this.limit);top.changeUrlParam(window);t.success||n.alert("操作失败:"+t.msg,{title:"错误",icon:5})}});r.on("toolbar(roleTable)",function(t){var u=r.checkStatus(t.config.id),f,e,o,s,h,c;switch(t.event){case"add":n.open({type:2,title:"添加角色",content:"/Admin/Role/Add?iframeName="+window.name,skin:"layui-layer-lan",area:["500px","360px"],offset:"auto",shade:.3});break;case"update":if(u.data.length!==1){n.msg("请先选择有且仅有一个角色");return}f=u.data[0].name;e=u.data[0].id;n.open({type:2,title:"编辑角色 "+f,content:"/Admin/Role/Edit?roleId="+e+"&iframeName="+window.name,skin:"layui-layer-lan",area:["500px","400px"],offset:"auto",shade:.3});break;case"set":if(u.data.length!==1){n.msg("请先选择有且仅有一个角色");return}o=u.data[0].name;s=u.data[0].id;n.open({type:2,title:"设置角色权限 "+o,content:"/Admin/Role/QueryPermissionList?roleId="+s,skin:"layui-layer-lan",area:["1100px","750px"],offset:"auto",shade:.3});break;case"delete":if(u.data.length!==1){n.msg("请先选择有且仅有一个用户");return}h=u.data[0].name;c=u.data[0].id;n.confirm("您确定要删除 "+h+" 角色吗?(注意:包括删除与用户与权限的关系)",{icon:3,title:"警告"},function(t){i.post("/Admin/Role/Delete",{id:c},function(i){return i.success?(n.msg("操作成功"),r.reload("roleTable"),n.close(t),!1):(n.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1)})})}});i("#search").on("click",function(){var n=i("#name").val();r.reload("roleTable",{page:{curr:1},where:{name:n}})})});