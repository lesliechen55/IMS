layui.config({base:"/module/"}).extend({treeGrid:"authtree"}).use(["jquery","authtree","layer","form"],function(){var i=layui.jquery,n=layui.authtree,f=layui.form,r=parent.layer===undefined?layui.layer:top.layer,u=i("#id").val(),t="#permissionTree";i.ajax({method:"post",url:"/Admin/Role/QueryPermissionList?roleId="+u,success:function(i){var r=n.listConvert(i.data,{primaryKey:"id",startPid:0,parentKey:"pid",nameKey:"name",valueKey:"id",checkedKey:i.checkedIdList});n.render(t,r,{inputname:"authids[]",openchecked:!0,openall:!0,layfilter:"lay-check-auth",autowidth:!0})}});i("#checkAll").click(function(){n.checkAll(t)});i("#uncheckAll").click(function(){n.uncheckAll(t)});i("#showAll").click(function(){n.showAll(t)});i("#closeAll").click(function(){n.closeAll(t)});i("#getMaxDept").click(function(){r.alert("树"+t+"的最大深度为："+n.getMaxDept(t))});i("#getCheckedNodes").click(function(){var u=n.getAll(t),i=n.getChecked(t),f=n.getNotChecked(t),e=n.getLeaf(t),o=n.getLastChecked(t),s=n.getLastNotChecked(t);console.log("all",u,"\n","checked",i,"\n","notchecked",f,"\n","leaf",e,"\n","lastChecked",o,"\n","lastNotChecked",s,"\n");r.alert("当前选择的权限ID集合: "+i)});i("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)});i("#submit").click(function(){var f=n.getChecked(t);return i.post("/Admin/Role/SetPermissionList",{id:u,permissionIdList:f},function(n){return n.success?(r.msg("操作成功"),i("#close").click(),!1):(r.alert("操作失败:"+n.msg,{title:"错误",icon:5}),!1)}),!1})});