layui.use(["laydate","form","layer","table","laytpl"],function(){var u=layui.form,i=parent.layer===undefined?layui.layer:top.layer,t=layui.jquery,f=layui.laytpl,r=layui.table,n=top.initFilter(window);layui.laydate.render({elem:"#startTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(n){var r=t("#endTime").val();r&&n>r&&(i.alert("开始日期不能大于结束日期"),t("#startTime").val(""))}});layui.laydate.render({elem:"#endTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(n){var r=t("#startTime").val();r&&n<r&&(i.alert("开始日期不能大于结束日期"),t("#endTime").val(""))}});r.render({elem:"#table",method:"post",url:"/Message/SendTask/GetPageData",height:"full-"+n.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"projectName",title:"项目名称",width:100},{field:"channel",title:"发送通道",width:100},{field:"templateName",title:"模板名称"},{field:"remarks",title:"任务描述"},{field:"stateName",title:"发送状态",width:100},{field:"pushSucess",title:"成功数",width:80},{field:"pushFail",title:"失败数",width:80},{field:"createBy",title:"创建人",width:100},{field:"createTime",title:"创建时间",width:160},{field:"updateBy",title:"修改人",width:100},{field:"updateTime",title:"更新时间",width:160}]],page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{projectId:n.projectId,channelId:n.channelId,startTime:n.startTime,endTime:n.endTime,templateName:n.templateName},done:function(n,i){t("#page").val(i);t("#limit").val(this.limit);top.changeUrlParam(window)}});r.on("toolbar(table)",function(n){var t=r.checkStatus(n.config.id);switch(n.event){case"update":if(t.data.length!==1){i.msg("请先选择有且仅有一个基础模板");return}var u=t.data[0].remarks,f=t.data[0].taskId,e=t.data[0].state;if(e!=5)return i.alert(u+"处于“"+t.data[0].stateName+"”状态，不能修改。"),!1;i.open({type:2,title:"修改 "+u,content:"/Message/SendTask/Edit?iframeName="+window.name+"&id="+f,skin:"layui-layer-lan",area:["700px","520px"],offset:"auto",shade:.3,maxmin:!0})}});t("#search").on("click",function(){var i=t("form").serialize().split("&"),n={};for(var u in i)i.hasOwnProperty(u)&&(n[i[u].split("=")[0]]=decodeURIComponent(i[u].split("=")[1]));return r.reload("table",{page:{curr:1},where:{projectId:n.projectId,channelId:n.channelId,startTime:n.startTime,endTime:n.endTime,templateName:n.templateName}}),!0})});