layui.use(["form","layer","table","laytpl"],function(){var u=layui.form,n=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,f=layui.laytpl,r=layui.table,t=top.initFilter(window);r.render({elem:"#table",method:"post",url:"/Message/TemplateType/GetPageData",height:"full-"+t.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"templateNo",title:"模板编号",width:260},{field:"templateCode",title:"Code",width:80},{field:"channelName",title:"发送通道",width:88},{field:"templateName",title:"模板名称"},{field:"templateDescribe",title:"模板描述"},{field:"createTime",title:"创建时间",width:160},{field:"updateTime",title:"更新时间",width:160}]],page:{limit:t.limit?t.limit:10,limits:[10,15,20,25],curr:t.page?t.page:1},where:{projectId:t.projectId,channelId:t.channelId,templateName:t.templateName},done:function(n,t){i("#page").val(t);i("#limit").val(this.limit);top.changeUrlParam(window)}});r.on("toolbar(table)",function(t){var u=r.checkStatus(t.config.id),e,h,o,f;switch(t.event){case"viewTemplate":if(u.data.length!==1){n.msg("请先选择有且仅有一个基础模板");return}var e=u.data[0].templateName,f=u.data[0].templateTypeId,s=JSON.parse(window.top.sessionStorage.getItem("curmenu"));window.top.addMyTab("/message/template/index?templateTypeId="+f,"语言模板-"+e,s.topMenuName,s.leftMenuName);break;case"add":n.open({type:2,title:"添加基础模板",content:"/Message/TemplateType/Add?iframeName="+window.name,skin:"layui-layer-lan",area:["900px","820px"],offset:"auto",shade:.3,maxmin:!0});break;case"update":if(u.data.length!==1){n.msg("请先选择有且仅有一个基础模板");return}e=u.data[0].templateName;f=u.data[0].templateTypeId;n.open({type:2,title:"修改 "+e,content:"/Message/TemplateType/Edit?iframeName="+window.name+"&id="+f,skin:"layui-layer-lan",area:["900px","820px"],offset:"auto",shade:.3,maxmin:!0});break;case"preview":if(u.data.length!==1){n.msg("请先选择有且仅有一个基础模板");return}var e=u.data[0].templateName,f=u.data[0].templateTypeId,c=u.data[0].templateCode;return c==999999?n.open({type:2,title:"预览 "+e,content:"/Message/TemplateType/Preview?id="+f,skin:"layui-layer-lan",area:["900px","820px"],offset:"auto",shade:.3,maxmin:!0,btn:["发送","关闭"],yes:function(){n.open({type:2,title:"发送 "+e,content:"/Message/SendTask/Add?id="+f+"&templateName="+e+"&channel="+u.data[0].channel,skin:"layui-layer-lan",area:["700px","520px"],offset:"auto",shade:.3,maxmin:!0})},btn2:function(){},cancel:function(){}}):n.open({type:2,title:"预览 "+e,content:"/Message/TemplateType/Preview?id="+f,skin:"layui-layer-lan",area:["900px","820px"],offset:"auto",shade:.3,maxmin:!0}),!1;case"export":if(u.data.length!==1){n.msg("请先选择有且仅有一个基础模板");return}return o=u.data[0].templateName,f=u.data[0].templateTypeId,n.load(3),h=i(this).attr("href")+"?id="+f,i.fileDownload(h,{httpMethod:"get",successCallback:function(){n.closeAll();n.msg("文件下载成功请保存到您的电脑上面!",{icon:1})},failCallback:function(t){n.closeAll();t=JSON.parse(t.replace(/<[^>]+>/g,""));n.alert("操作失败:"+t.msg,{title:"文件下载失败",icon:5})}}),!1;case"import":n.open({type:2,title:"导入语言词条",content:"/Message/TemplateType/Import",skin:"layui-layer-lan",area:["500px","420px"],offset:"auto",shade:.3});break;case"updateTemplate":if(u.data.length!==1){n.msg("请先选择有且仅有一个基础模板");return}o=u.data[0].templateName;f=u.data[0].templateTypeId;n.confirm("确认要批量更新“"+o+"”的语言模板吗？",{icon:3,title:"提示"},function(t){i.get("/Message/TemplateType/UpdateTemplate",{id:f},function(i){return i.success?(n.msg("操作成功"),n.close(t),!1):(n.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1)})})}});i("#search").on("click",function(){var n=i("form").serialize().split("&"),t={};for(var u in n)n.hasOwnProperty(u)&&(t[n[u].split("=")[0]]=decodeURIComponent(n[u].split("=")[1]));return r.reload("table",{page:{curr:1},where:{projectId:t.projectId,channelId:t.channelId,templateName:t.templateName}}),!0})});