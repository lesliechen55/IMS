layui.use(["form","layer","table","laytpl"],function(){var u=layui.form,n=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,f=layui.laytpl,r=layui.table,t=top.initFilter(window);r.render({elem:"#table",method:"post",url:"/Message/Template/GetPageData",height:"full-"+t.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"language",title:"模板语言",width:160},{field:"projectName",title:"项目名称",width:88},{field:"channelName",title:"发送通道",width:88},{field:"templateName",title:"模板名称"},{field:"templateTitle",title:"模板标题"}]],page:{limit:t.limit?t.limit:10,limits:[10,15,20,25],curr:t.page?t.page:1},where:{templateTypeId:t.templateTypeId,language:t.language},done:function(n,t){i("#page").val(t);i("#limit").val(this.limit);top.changeUrlParam(window)}});r.on("toolbar(table)",function(t){var u=r.checkStatus(t.config.id),f,e;if(u.data.length!==1){n.msg("请先选择有且仅有一个语言模板");return}f=u.data[0].templateName;e=u.data[0].templateId;switch(t.event){case"delete":n.confirm("确认要删除“"+u.data[0].language+"”模板吗？",{icon:3,title:"提示"},function(t){i.get("/Message/Template/Delete",{id:e},function(r){return r.success?(n.msg("操作成功"),i("#search").trigger("click"),n.close(t),!1):(n.alert("操作失败:"+r.msg,{title:"错误",icon:5}),!1)})});break;case"preview":return n.open({type:2,title:"预览 "+f,content:"/Message/TemplateType/TemplatePreview?id="+e,skin:"layui-layer-lan",area:["900px","820px"],offset:"auto",shade:.3,maxmin:!0,btn:["测试发送","关闭"],yes:function(){n.open({type:2,title:"发送 "+f,content:"/Message/SendTask/SendTemplateTest?id="+e+"&templateName="+f+"&channel="+u.data[0].channel,skin:"layui-layer-lan",area:["700px","420px"],offset:"auto",shade:.3,maxmin:!0})},btn2:function(){},cancel:function(){}}),!1}});i("#search").on("click",function(){var n=i("form").serialize().split("&"),t={};for(var u in n)n.hasOwnProperty(u)&&(t[n[u].split("=")[0]]=decodeURIComponent(n[u].split("=")[1]));return r.reload("table",{page:{curr:1},where:{templateTypeId:t.templateTypeId,language:t.language}}),!0})});