function addTab(n){tab.tabAdd(n)}var $,tab,dataStr,layer,topMenuName="";layui.config({base:"/js/"}).extend({bodyTab:"bodyTab"});layui.use(["bodyTab","form","element","layer","jquery"],function(){function e(){var t=window.location.href,e="",u,f;t.indexOf("?")>-1&&(u=t.split("?"),t=u[0],e="?"+u[1]);f=t.split("#");f.length>1&&(i=f[1].split("/"),i.forEach(function(n,t){n==""&&i.splice(t,1)}),i.length>0&&(topMenuName=i[0],n="/"+i.slice(1).join("/"),r=n+e))}function o(t){$.getJSON(tab.tabConfig.url,function(u){var s,f,e,h,o;if(dataStr=u[t],tab.render(),n!=""){if(n=="/home/main")return;s=getUrlParam(r,"permissioncode");s!=""&&(n+="?permissioncode="+s);f=$(".layui-nav .layui-nav-item a:not('.mobileTopLevelMenus .layui-nav-item a')[data-url='"+n+"']");e="";$(f).length>0?e=$(f).find("cite").text():(n="/"+i.slice(1,i.length-1).join("/")+"/index",f=$(".layui-nav .layui-nav-item a:not('.mobileTopLevelMenus .layui-nav-item a')[data-url='"+n+"']"),$(f).length>0?window.sessionStorage.getItem("menu")&&(o=JSON.parse(window.sessionStorage.getItem("menu")),o.forEach(function(n){if(n.href==r){e=n.title;return}})):(h=r.split("?")[0].split("/").join(""),window.sessionStorage.getItem("menu")&&(o=JSON.parse(window.sessionStorage.getItem("menu")),o.forEach(function(t){if(t.name==h){n=t.leftMenuName;f=$(".layui-nav .layui-nav-item a:not('.mobileTopLevelMenus .layui-nav-item a')[data-url='"+n+"']");t.href==r&&(e=t.title);return}}))));$(f).length>0&&(e==""&&(e=$(f).find("cite").text()+"详情"),addTab($('<a topMenuName="'+topMenuName+'" leftMenuName="'+n+'" data-url="'+r+'"><i class="seraph icon-look" data-icon="icon-look"><\/i><cite>'+e+"<\/cite><\/a>")),$("body").removeClass("site-mobile"),$(f).parents("dl").parent().addClass("layui-nav-itemed").siblings().removeClass("layui-nav-itemed").removeClass("layui-this"),$(f).parent().addClass("layui-this").siblings().removeClass("layui-this"))}else n="/home/main"})}function s(){var t=[],f,e,o,i;if(window.sessionStorage.getItem("menu")==null)f={icon:"icon-look",title:"我的首页",name:"homemain",href:"/home/main",layId:"",topMenuName:defaultKey,leftMenuName:"/home/main"},t.push(f),window.sessionStorage.setItem("menu",JSON.stringify(t)),window.sessionStorage.setItem("curmenu",JSON.stringify(f));else if(cacheStr=="true"){for(f=window.sessionStorage.getItem("curmenu"),t=JSON.parse(window.sessionStorage.getItem("menu")),(topMenuName==""||n=="")&&(e=[],f?e=JSON.parse(f):(e=t[0],f=JSON.stringify(e),window.sessionStorage.setItem("curmenu",f)),topMenuName=e.topMenuName,n=e.leftMenuName,r=e.href),o="",i=1;i<t.length;i++)o="",t[i].icon&&(o+=t[i].icon.split("-")[0]=="icon"?'<i class="seraph '+t[i].icon+'"><\/i>':'<i class="layui-icon">'+t[i].icon+"<\/i>"),o+='<cite name="'+t[i].name+'">'+t[i].title+"<\/cite>",o+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+t[i].layId+'">&#x1006;<\/i>',u.tabAdd("bodyTab",{title:o,content:"<iframe name='"+t[i].name+"' data-id='"+t[i].layId+"'><\/iframe>",id:t[i].layId}),f?JSON.parse(f).name==t[i].name&&u.tabChange("bodyTab",t[i].layId):u.tabChange("bodyTab",t[t.length-1].layId);tab.tabMove()}else window.sessionStorage.removeItem("menu"),window.sessionStorage.removeItem("curmenu")}var h=layui.form,u=layui.element,f,t;$=layui.$;layer=parent.layer===undefined?layui.layer:top.layer;var n="",r="",i=[];tab=layui.bodyTab({openTabNum:10,url:"/Home/GetMenuData"});e();$(".topLevelMenus li,.mobileTopLevelMenus dd").click(function(){topMenuName=$(this).data("menu");$(".topLevelMenus li").eq($(this).index()).addClass("layui-this").siblings().removeClass("layui-this");$(".mobileTopLevelMenus dd").eq($(this).index()).addClass("layui-this").siblings().removeClass("layui-this");$(".layui-layout-admin").removeClass("showMenu");$("body").addClass("site-mobile");f&&(n="");o($(this).data("menu"));tab.tabMove()});$(".hideMenu").click(function(){if($(".topLevelMenus li.layui-this a").data("url"))return layer.msg("此栏目状态下左侧菜单不可展开"),!1;$(".layui-layout-admin").toggleClass("showMenu");tab.tabMove()});f=!1;defaultKey!==null&&defaultKey!==""&&(s(),$("*[mobile]").css("display")=="none"?topMenuName==""?(topMenuName=defaultKey,t=$(".topLevelMenus li[data-menu='"+defaultKey+"']")):(t=$(".topLevelMenus li[data-menu='"+topMenuName+"']"),$(t).length==0&&(t=$(".topLevelMenus li[data-menu='"+defaultKey+"']"))):topMenuName==""?(topMenuName=defaultKey,t=$(".mobileTopLevelMenus dd[data-menu='"+defaultKey+"']")):(t=$(".mobileTopLevelMenus dd[data-menu='"+topMenuName+"']"),$(t).length==0&&(t=$(".mobileTopLevelMenus dd[data-menu='"+defaultKey+"']"))),$(t).length>0&&($(t).trigger("click"),f=!0));$("a.logo").on("click",function(){var n=JSON.parse(window.sessionStorage.getItem("menu"))[0],t;u.tabChange("bodyTab","").init();window.sessionStorage.setItem("curmenu",JSON.stringify(n));tab.tabMove();n&&(t=window.location.href,t.indexOf("#")>-1&&(t=t.split("#")[0]),window.location.href=t+"#/"+n.topMenuName+n.href,tab.changeRegresh($(this).index(),n.href,changeRefreshStr),top.positionMenu(n))});$(".site-tree-mobile").on("click",function(){$("body").addClass("site-mobile")});$(".site-mobile-shade").on("click",function(){$("body").removeClass("site-mobile")});$("body").on("click",".layui-nav .layui-nav-item a:not('.mobileTopLevelMenus .layui-nav-item a,.topLevelMenus .layui-nav-item a')",function(){$(this).siblings().length===0&&(n=$(this).attr("data-url"),$(this).attr("topMenuName",topMenuName),$(this).attr("leftMenuName",n),addTab($(this)),$("body").removeClass("site-mobile"));$(this).parents("dl").parent().addClass("layui-nav-itemed").siblings()});$(".clearCache").click(function(){window.sessionStorage.clear();window.localStorage.clear();var n=layer.msg("清除缓存中，请稍候",{icon:16,time:!1,shade:.8});return setTimeout(function(){layer.close(n);location.href="/";layer.msg("缓存清除成功！")},1e3),!1});$("#selfInfo").click(function(){var n=$(this).prop("href");return layer.open({type:2,title:"个人资料",content:n,skin:"layui-layer-lan",area:["500px","450px"],offset:"auto",shade:.3}),!1});$("#changePwd").click(function(){var n=$(this).prop("href");return layer.open({type:2,title:"修改密码",content:n,skin:"layui-layer-lan",area:["500px","280px"],offset:"auto",shade:.3}),!1});window.positionMenu=function(n){if(n&&n.topMenuName!=""&&n.leftMenuName!=""){var t=$(".topLevelMenus li[data-menu='"+n.topMenuName+"']"),i=$(".mobileTopLevelMenus dd[data-menu='"+n.topMenuName+"']");$(t).length>0&&$(t).addClass("layui-this").siblings().removeClass("layui-this");$(i).length>0&&$(i).addClass("layui-this").siblings().removeClass("layui-this");$(".layui-layout-admin").removeClass("showMenu");$("body").addClass("site-mobile");$.getJSON(tab.tabConfig.url,function(t){dataStr=t[n.topMenuName];tab.render();var i=$(".layui-nav .layui-nav-item a:not('.mobileTopLevelMenus .layui-nav-item a')[data-url='"+n.leftMenuName+"']");$("body").removeClass("site-mobile");$(i).parents("dl").parent().addClass("layui-nav-itemed").siblings().removeClass("layui-nav-itemed").removeClass("layui-this");$(i).parent().addClass("layui-this").siblings().removeClass("layui-this")})}}});