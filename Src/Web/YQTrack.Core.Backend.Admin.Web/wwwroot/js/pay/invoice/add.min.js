layui.use(["layer","jquery","form","upload"],function(){var i=layui.form,t=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery,r=layui.upload,u;i.verify({formFile:function(t,i){if(!i.src&&n("#invoiceType").val()==2)return"请上传一般纳税人证明"},notEmpty:function(t){if(!t&&n("#invoiceType").val()==2)return"必填项不能为空"}});n("#userEmail").blur(function(){if(n("#userEmail").val()=="")return n("#userEmail").css("border-color","red"),n("#userEmail").focus(),t.msg("用户邮箱不能为空!",{icon:5,anim:6}),!1;n("#userEmail").css("border-color","rgb(230, 230, 230)");n.get("/Pay/Invoice/GetUserId",{userEmail:n("#userEmail").val()},function(i){if(!i.success||!i.data)return t.msg("找不到该用户!",{icon:5,anim:6}),n("#userEmail").focus(),!1;n("#userEmail").css("border-color","green");n("#userEmail").attr("userId",i.data)})});u=r.render({elem:"#upload",url:"/Pay/Invoice/UploadTaxImage",method:"post",accept:"images",auto:!0,size:2048,multiple:!1,number:1,field:"formFile",data:{userId:function(){return n("#userEmail").attr("userId")}},drag:!1,exts:"jpg|jpeg|png",acceptMime:"image/jpg, image/png, image/jpeg",done:function(i){return(t.closeAll("loading"),!i.success)?(t.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1):(n("#taxPayerCertificateUrl").val(i.data),!1)},error:function(){t.closeAll("loading")},choose:function(t){t.preview(function(t,i,r){n("#img").prop("src",r)})},allDone:function(){},before:function(){n("#userEmail").attr("userId")||(t.msg("用户邮箱不能为空!",{icon:5,anim:6}),n("#userEmail").css("border-color","red"),n("#userEmail").focus());t.load()}});i.on("submit(form)",function(i){return n.post("/Pay/Invoice/Add",i.field,function(i){return i.success?(t.msg("操作成功",{icon:6}),top.refreshParent(),n("#close").click(),!1):(t.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1)}),!1});n("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)})});