layui.use(["layer","jquery","table","form","laydate"],function(){function f(){var n=t("form").serialize().split("&"),r={};for(var i in n)n.hasOwnProperty(i)&&(r[n[i].split("=")[0]]=decodeURIComponent(n[i].split("=")[1]).replace(/\+/g," "));return r}var e=layui.form,u=parent.layer===undefined?layui.layer:top.layer,t=layui.jquery,o=layui.laytpl,i=layui.table,r=layui.laydate,n;r.render({elem:"#startTime"});r.render({elem:"#endTime"});n=top.initFilter(window);n.activityName!="undefined"&&(t("#activityName").val(""),n.activityName="");i.render({elem:"#table",method:"post",url:"/Pay/ActivityCoupon/GetPageData",cellMinWidth:60,checkStatus:!1,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],height:"full-"+n.top,cols:[[{field:"activityCouponId",title:"优惠券ID",width:180},{field:"activityName",title:"活动名称",width:180},{field:"purchaseOrderId",title:"订单编号",templet:function(n){return n.purchaseOrderId==null?"":'<a class="layui-table-link" lay-event="view" lay-filter="view">'+n.purchaseOrderId+"<\/a>"},width:180},{field:"userId",title:"用户ID",templet:function(n){return n.userId=="0"?n.userId:'<a class="layui-table-link" lay-event="viewUser" lay-filter="viewUser">'+n.userId+"<\/a>"},width:200},{field:"email",title:"用户Email",width:180},{field:"startTime",title:"开始时间",templet:function(n){return layui.util.toDateString(n.startTime,"yyyy-MM-dd")}},{field:"endTime",title:"结束时间",templet:function(n){return layui.util.toDateString(n.endTime,"yyyy-MM-dd")}},{field:"status",title:"状态",templet:function(n){return n.status==1?"未使用":n.status==2?"已使用":n.status==0?"None":void 0}},{field:"rule",title:"享受的优惠",width:230},{field:"actualDiscount",title:"优惠金额"},{field:"source",title:"来源",templet:function(n){switch(n.source){case"0":case"":return"None";case"1":return"Email";case"2":return"Twitter";case"3":return"Facebook";case"4":return"Weibo";case"5":return"QQ";case"6":return"Weixin";default:return n.source}}}]],page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{activityName:n.activityName,purchaseOrderId:n.purchaseOrderId,status:n.status,userEmail:n.userEmail,userId:n.userId},done:function(n,i){t("#page").val(i);t("#limit").val(this.limit);top.changeUrlParam(window);n&&n.success!==undefined&&!n.success&&u.alert("操作失败:"+n.msg,{title:"错误",icon:5})}});t("#search").on("click",function(){var n=f();return i.reload("table",{page:{curr:1},where:{activityName:n.activityName,purchaseOrderId:n.purchaseOrderId,status:n.status,userEmail:n.userEmail,userId:n.userId}}),!0});i.on("tool(table)",function(n){var t=JSON.parse(window.top.sessionStorage.getItem("curmenu"));switch(n.event){case"view":window.top.addMyTab("/pay/purchaseorder/viewproduct?id="+n.data.purchaseOrderId,"订单详情",t.topMenuName,t.leftMenuName);break;case"viewUser":window.top.addMyTab("/business/user/detail?userId="+n.data.userId,"用户详情","systemcenter",t.leftMenuName)}})});