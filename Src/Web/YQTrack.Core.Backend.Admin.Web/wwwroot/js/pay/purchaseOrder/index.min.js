layui.use(["form","layer","table","laytpl","laydate"],function(){var f=layui.form,r=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,e=layui.laytpl,u=layui.table,t=layui.formSelects,n=top.initFilter(window,t);layui.laydate.render({elem:"#startTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(n){var t=i("#endTime").val();t&&n&&n>t&&(r.alert("开始日期不能大于结束日期"),i("#startTime").val(""))}});layui.laydate.render({elem:"#endTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(n){var t=i("#startTime").val();t&&n&&n<t&&(r.alert("开始日期不能大于结束日期"),i("#endTime").val(""))}});u.render({elem:"#table",method:"post",url:"/Pay/PurchaseOrder/GetPageData",height:"full-"+n.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{field:"purchaseOrderId",title:"订单编号",templet:function(n){return'<a class="layui-table-link" lay-event="view" lay-filter="view">'+n.purchaseOrderId+"<\/a>"},width:180},{field:"name",title:"订单名称",width:150},{field:"userPlatformType",title:"平台类型",width:88},{field:"currencyType",title:"货币类型",width:88},{field:"serviceType",title:"服务类型",width:88},{field:"paymentAmount",title:"实付价",width:88},{field:"userId",title:"用户ID",templet:function(n){return n.userId=="0"?n.userId:'<a class="layui-table-link" lay-event="viewUser" lay-filter="viewUser">'+n.userId+"<\/a>"},width:180},{field:"nickName",title:"用户名称",width:160},{field:"providerId",title:"支付方式",width:125},{field:"status",title:"状态",width:100},{field:"conflict",title:"是否冲突",width:88},{field:"createAt",title:"创建时间",width:160},{field:"updateAt",title:"修改时间",width:160},{field:"originalOrderId",title:"源订单号",width:180,hide:!0}]],page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{orderId:n.orderId,userId:n.userId,email:n.email,name:n.name,platformType:t.value("platformType","val"),currencyType:n.currencyType,serviceType:t.value("serviceType","val"),providerId:t.value("providerId","val"),purchaseOrderStatus:t.value("purchaseOrderStatus","val"),startTime:n.startTime,endTime:n.endTime,conflictOrder:n.conflictOrder},done:function(n,t){i("#page").val(t);i("#limit").val(this.limit);top.changeUrlParam(window);n&&n.success!==undefined&&!n.success&&r.alert("操作失败:"+n.msg,{title:"错误",icon:5})}});u.on("tool(table)",function(n){var t=JSON.parse(window.top.sessionStorage.getItem("curmenu"));switch(n.event){case"view":window.top.addMyTab("/pay/purchaseorder/viewproduct?id="+n.data.purchaseOrderId,"订单 "+n.data.name,t.topMenuName,t.leftMenuName);break;case"viewUser":window.top.addMyTab("/business/user/detail?userId="+n.data.userId,"用户详情","systemcenter",t.leftMenuName)}});i("#search").on("click",function(){var r=decodeURIComponent(i("form").serialize(),!0).split("&"),n={};for(var f in r)r.hasOwnProperty(f)&&(n[r[f].split("=")[0]]=r[f].split("=")[1].replace(/\+/g," "));return u.reload("table",{page:{curr:1},where:{orderId:n.orderId,userId:n.userId,email:n.email,name:n.name,platformType:t.value("platformType","val"),currencyType:n.currencyType,serviceType:t.value("serviceType","val"),providerId:t.value("providerId","val"),purchaseOrderStatus:t.value("purchaseOrderStatus","val"),startTime:n.startTime,endTime:n.endTime,conflictOrder:n.conflictOrder}}),!0})});