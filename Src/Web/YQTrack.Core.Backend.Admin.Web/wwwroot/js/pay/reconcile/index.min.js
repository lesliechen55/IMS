layui.use(["form","layer","table","laytpl","laydate"],function(){var f=layui.form,r=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery,e=layui.laytpl,i=layui.table,u=layui.formSelects,t=top.initFilter(window,u);layui.laydate.render({elem:"#startTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(t){var i=n("#endTime").val();i&&t>i&&(r.alert("开始日期不能大于结束日期"),n("#startTime").val(""))}});layui.laydate.render({elem:"#endTime",type:"date",format:"yyyy-MM-dd",min:"2015-1-1",max:"2050-12-31",lang:"cn",theme:"molv",calendar:!0,done:function(t){var i=n("#startTime").val();i&&t<i&&(r.alert("开始日期不能大于结束日期"),n("#endTime").val(""))}});i.render({elem:"#table",method:"post",url:"/Pay/Reconcile/GetPageData",height:"full-"+t.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"providerId",title:"支付商"},{field:"sheetCount",title:"对账笔数"},{field:"successCount",title:"成功笔数"},{field:"failedCount",title:"失败笔数",templet:"#failedCountTpl"},{field:"notExistCount",title:"不存在笔数"},{field:"refundedCount",title:"退款笔数"},{field:"totalCount",title:"总笔数"},{field:"beginTime",title:"对账时间"}]],page:{limit:t.limit?t.limit:10,limits:[10,15,20,25],curr:t.page?t.page:1},where:{paymentProvider:u.value("paymentProvider","val"),startTime:t.startTime,endTime:t.endTime},done:function(t,i){n("#page").val(i);n("#limit").val(this.limit);top.changeUrlParam(window)}});i.on("toolbar(table)",function(n){var t=i.checkStatus(n.config.id),u;if(t.data.length!==1){r.msg("请先选择有且仅有一个对账记录");return}var f=t.data[0].reconcileId,e=t.data[0].providerId,o=t.data[0].beginTime;switch(n.event){case"view":u=JSON.parse(window.top.sessionStorage.getItem("curmenu"));window.top.addMyTab("/pay/reconcile/view?id="+f,"对账记录明细-"+e+"【"+o+"】",u.topMenuName,u.leftMenuName)}});n("#search").on("click",function(){var t=n("form").serialize().split("&"),r={};for(var f in t)t.hasOwnProperty(f)&&(r[t[f].split("=")[0]]=decodeURIComponent(t[f].split("=")[1]));return i.reload("table",{page:{curr:1},where:{paymentProvider:u.value("paymentProvider","val"),startTime:r.startTime,endTime:r.endTime}}),!0})});