layui.use(["layer","laydate","jquery","table","form","laytpl","formSelects"],function(){var f=layui.laydate,i=layui.table,e=layui.formSelects,r=layui.form,t=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery;let u=JSON.parse(n("#hRules").val());r.on("submit(form)",function(r){var u,f;if(r.field.userEmail=n("#email").val(),t.rules=[],u=i.checkStatus("activityRule"),u.data.length>0)for(f=0;f<u.data.length;f++)t.rules.push(u.data[f]);else return t.alert("请至少勾选一个规则",{title:"错误",icon:5}),!1;return r.field.rules=t.rules,n(this).addClass("layui-btn-disabled").attr("disabled","disabled"),n.post("/pay/activity/addCoupon",r.field,function(i){return i.success?(t.msg(i.msg,{icon:6}),n("#close").click(),top.refreshParent(),!0):(t.alert("操作失败:"+i.msg,{title:"错误",icon:5}),n(".layui-btn-disabled").removeClass("layui-btn-disabled").removeAttr("disabled"),!1)},"json"),!1});n("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)});i.render({elem:"#activityRule",data:u,cols:[[{type:"checkbox"},{field:"id",title:"顺序"},{field:"c",title:"货币",templet:function(n){return n.c=="0"?"未知":n.c=="1"?"人民币":n.c=="2"?"美元":void 0}},{field:"t",title:"阈值"},{field:"d",title:"优惠"}]]})});