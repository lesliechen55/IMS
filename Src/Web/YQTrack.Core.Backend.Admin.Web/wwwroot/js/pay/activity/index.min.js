layui.use(["layer","jquery","table","form","laydate","laytpl"],function(){function f(n,r){t.ajax({url:"/pay/activity/changeStatus",method:"post",data:{activityId:n,status:r},dataType:"json",success:function(n){n.success?(i.msg("操作成功"),t(".layui-laypage-btn")[0].click()):i.msg("操作失败")}})}function e(){var n=t("form").serialize().split("&"),r={};for(var i in n)n.hasOwnProperty(i)&&(r[n[i].split("=")[0]]=decodeURIComponent(n[i].split("=")[1]).replace(/\+/g," "));return r}var o=layui.form,i=parent.layer===undefined?layui.layer:top.layer,t=layui.jquery,s=layui.laytpl,r=layui.table,u=layui.laydate,n;u.render({elem:"#startTime"});u.render({elem:"#endTime"});n=top.initFilter(window);r.on("toolbar(table)",function(n){var t=r.checkStatus(n.config.id);switch(n.event){case"add":i.open({type:2,title:"添加活动",content:"/Pay/Activity/Add?iframeName="+window.name,skin:"layui-layer-lan",area:["800px","930px"],offset:"auto",shade:.3,maxmin:!0})}});r.on("tool(table)",function(n){var o,r,u,e;switch(n.event){case"update":u=n.data.cnName;r=n.data.activityId;i.open({type:2,title:"编辑活动 "+u,content:"/Pay/Activity/Edit?iframeName="+window.name+"&id="+r,skin:"layui-layer-lan",area:["800px","930px"],offset:"auto",shade:.3,maxmin:!0});break;case"updateStatus":r=n.data.activityId;o=t(this).attr("attrStats");f(r,o);break;case"addCoupon":r=n.data.activityId;u=n.data.cnName;i.open({type:2,title:"发放优惠券—"+u,content:"/Pay/Activity/AddCoupon?iframeName="+window.name+"&id="+r,skin:"layui-layer-lan",area:["500px","400px"],offset:"auto",shade:.3,maxmin:!0});break;case"details":e=JSON.parse(window.top.sessionStorage.getItem("curmenu"));window.top.addMyTab("/Pay/Activity/view?id="+n.data.activityId,"查看活动详情",e.topMenuName,e.leftMenuName)}});r.render({elem:"#table",method:"post",url:"/Pay/Activity/GetPageData",cellMinWidth:60,checkStatus:!1,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],height:"full-"+n.top,cols:[[{type:"numbers"},{field:"cnName",title:"活动名称"},{field:"enName",title:"英文名称"},{field:"activityType",title:"活动类型",width:100},{field:"discountType",title:"优惠类型",width:100},{field:"couponMode",title:"优惠模式",width:180},{field:"startTime",title:"开始时间",width:120,templet:function(n){return layui.util.toDateString(n.startTime,"yyyy-MM-dd")}},{field:"endTime",title:"截至时间",width:120,templet:function(n){return layui.util.toDateString(n.endTime,"yyyy-MM-dd")}},{field:"status",title:"状态",width:100,templet:function(n){return n.status=="未知"?'<a class="layui-btn layui-btn-primary layui-btn-xs">None<\/a>':n.status=="待审核"?'<a class="layui-btn layui-btn-xs">待审核<\/a>':n.status=="审核通过"?'<a class="layui-btn layui-btn-normal layui-btn-xs">审核通过<\/a>':n.status=="已上架"?'<a class="layui-btn layui-btn-warm layui-btn-xs">已上架<\/a>':n.status=="已驳回"?'<a class="layui-btn layui-btn-danger layui-btn-xs">已驳回<\/a>':'<a class="layui-btn layui-btn-disabled layui-btn-xs">'+n.status+"<\/a>"}},{field:"internalUse",title:"内部使用",templet:function(n){return'<input type="radio" title="'+(n.internalUse?"是":"否")+(n.internalUse?'" checked':'"')+">"},width:100},{field:"operate",title:"操作",templet:function(n){var i='<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="update" value="'+n.activityId+'">编辑<\/a>',t='<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="details" value="'+n.activityId+'">详情<\/a>';return n.status=="未知"?(i+='<button class="layui-btn layui-btn-xs" lay-event="updateStatus" attrStats="1">提交审核<\/button>',t+i):n.status=="待审核"?(i+='<button class="layui-btn layui-btn-normal layui-btn-xs" lay-event="updateStatus" attrStats="2">通过<\/button><button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="updateStatus" attrStats="6">驳回<\/button>',t+i):n.status=="审核通过"?t+'<button class="layui-btn layui-btn-warm layui-btn-xs" lay-event="updateStatus" attrStats="3">上架<\/button><button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateStatus" attrStats="5">下架<\/button>':n.status=="已上架"?n.activityType=="通用活动"?t+'<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateStatus" attrStats="5">下架<\/button>':t+'<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateStatus" attrStats="5">下架<\/button><button class="layui-btn layui-btn-green layui-btn-sm" lay-event="addCoupon">发放优惠券<\/button>':n.status=="已驳回"?t+'<button class="layui-btn layui-btn-primary layui-btn-xs" lay-event="updateStatus" attrStats="0">重置<\/button>':t},width:220}]],page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{keyword:n.keyword,productId:n.productId,activityType:n.activityType,activityStatus:n.activityStatus,startTime:n.startTime,endTime:n.endTime},done:function(n,r){t("#page").val(r);t("#limit").val(this.limit);top.changeUrlParam(window);n&&n.success!==undefined&&!n.success&&i.alert("操作失败:"+n.msg,{title:"错误",icon:5})}});t("#search").on("click",function(){var n=e();return r.reload("table",{page:{curr:1},where:{keyword:n.keyword,productId:n.productId,activityType:n.activityType,activityStatus:n.activityStatus,startTime:n.startTime,endTime:n.endTime}}),!0})});