layui.use(["form","layer","table","laytpl"],function(){var r=layui.form,t=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,f=layui.laytpl,u=layui.table,n=top.initFilter(window);u.render({elem:"#table",method:"post",url:"/Pay/ProductSku/GetPageData",height:"full-"+n.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"productSkuId",title:"SKU-ID",hide:!0},{field:"name",title:"SKU名称"},{field:"code",title:"SKU编码"},{field:"description",title:"SKU描述"},{field:"isInternalUse",title:"内部使用",width:90},{field:"active",title:"是否启用",event:"active",templet:"#active",width:100},{field:"productName",title:"商品名称"},{field:"productCategoryName",title:"商品分类"},{field:"memberLevel",title:"会员类型",width:180},{field:"skuType",title:"类型",width:100},{field:"priceCount",title:"价格数量",width:100},{field:"createAt",title:"创建时间",width:160},{field:"updateAt",title:"更新时间",width:160}]],page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{name:n.name,code:n.code,desc:n.desc,productType:n.productType},done:function(n,t){i("#page").val(t);i("#limit").val(this.limit);top.changeUrlParam(window)}});r.on("switch(active)",function(n){var f=n.elem.value,e=n.elem.checked?"您确定要启用当前SKU吗":"您确定要禁用当前SKU吗",u=n.elem.checked;return t.open({content:e,icon:3,btn:["确定","取消"],yes:function(e){i.post("/Pay/ProductSku/ChangeStatus",{skuId:f,enable:u},function(i){if(i.success)n.elem.checked=u;else{t.alert("操作失败:"+i.msg,{title:"错误",icon:5});n.elem.checked=!u;r.render("checkbox");return}r.render("checkbox");t.msg("操作成功!",{icon:6});t.close(e)})},btn2:function(i){n.elem.checked=!u;r.render("checkbox");t.close(i)},cancel:function(){n.elem.checked=!u;r.render("checkbox")}}),!1});u.on("toolbar(table)",function(n){var i=u.checkStatus(n.config.id),r,f;switch(n.event){case"add":t.open({type:2,title:"添加商品SKU",content:"/Pay/ProductSku/Add?iframeName="+window.name,skin:"layui-layer-lan",area:["900px","490px"],offset:"auto",shade:.3,maxmin:!0});break;case"edit":if(i.data.length!==1){t.msg("请先选择有且仅有一个商品");return}r=i.data[0].name;f=i.data[0].productSkuId;t.open({type:2,title:"修改商品SKU "+r,content:"/Pay/ProductSku/Edit?iframeName="+window.name+"&id="+f,skin:"layui-layer-lan",area:["1000px","900px"],offset:"auto",shade:.3,maxmin:!0})}});i("#search").on("click",function(){return u.reload("table",{page:{curr:1},where:{name:i("#name").val(),code:i("#code").val(),desc:i("#desc").val(),productType:i("#productType").val()}}),!0})});