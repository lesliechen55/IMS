layui.use(["layer","jquery","form","element","table","laytpl"],function(){var u=layui.form,n=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,o=layui.laytpl,t=layui.table,f=layui.element;f.on("tab(tabFilter)",function(n){n.index===0&&t.reload("tablePrice");n.index===1&&t.reload("tableBusiness")});const r=i("#productSkuId").val(),e=i("#active").val()==="true"?!0:!1;u.on("switch(isInternalUse)",function(n){var t=n.elem.value;t==="true"?(n.elem.value="false",i(n.elem).removeAttr("checked")):n.elem.value="true"});u.on("submit(form)",function(t){let r=i("input[name=isInternalUse]").val();return r==="true"&&t.field.skuType!=="2"&&t.field.skuType!=="3"?(n.alert("操作失败:只能SKU类型为邮件数或者查询数才能启用内部使用开关!",{title:"警告",icon:5}),!1):(t.field.isInternalUse=r,i.post("/Pay/ProductSku/Edit",t.field,function(t){return t.success?(n.msg("操作成功",{icon:6}),top.refreshParent(),i("#close").click(),!1):(n.alert("操作失败:"+t.msg,{title:"错误",icon:5}),!1)}),!1)});i("#close").click(function(){var n=parent.layer.getFrameIndex(window.name);parent.layer.close(n)});t.render({elem:"#tablePrice",method:"post",url:"/Pay/ProductSku/GetPriceList?skuId="+r,page:!1,height:330,cellMinWidth:60,toolbar:"#toolbarPrice",defaultToolbar:[],limits:[10,15,20,25],cols:[[{type:"numbers"},{type:"radio"},{field:"productSkuPriceId",title:"SkuPriceId",hide:!0},{field:"platformType",title:"平台类型"},{field:"currencyType",title:"货币类型"},{field:"saleUnitPrice",title:"销售价"},{field:"amount",title:"实付价"},{field:"description",title:"描述"},{field:"createAt",title:"创建时间",minWidth:180},{field:"updateAt",title:"更新时间",minWidth:180}]]});t.on("toolbar(tablePrice)",function(u){var f=t.checkStatus(u.config.id),e;switch(u.event){case"add":n.open({type:2,title:"添加SKU价格信息",content:"/Pay/ProductSku/AddPrice?iframeName="+window.name+"&id="+r+"&tableId=tablePrice",skin:"layui-layer-lan",area:["900px","420px"],offset:"auto",shade:.3,maxmin:!0,end:function(){t.reload("tablePrice")}});break;case"delete":if(f.data.length!==1){n.msg("请先选择有且仅有一个SKU价格信息");return}e=f.data[0].productSkuPriceId;n.confirm("您确定要删除当条价格信息吗?",{icon:3,title:"提示"},function(u){i.post("/Pay/ProductSku/DeletePrice",{skuId:r,priceId:e},function(i){return i.success?(n.msg("操作成功"),t.reload("tablePrice"),n.close(u),!1):(n.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1)})})}});t.render({elem:"#tableBusiness",method:"post",url:"/Pay/ProductSku/GetBusinessList?skuId="+r,page:!1,height:330,cellMinWidth:60,toolbar:"#toolbarBusiness",defaultToolbar:[],limits:[10,15,20,25],cols:[[{type:"numbers"},{type:"radio"},{field:"businessCtrlType",title:"业务类型"},{field:"consumeType",title:"消费类型"},{field:"renew",title:"是否续费",templet:function(n){return'<input type="checkbox" lay-skin="switch" lay-text="ON|OFF" '+(n.renew?"checked":"")+" disabled>"}},{field:"validity",title:"有效期(月)"},{field:"quantity",title:"业务数量"}]]});t.on("toolbar(tableBusiness)",function(u){var f,o;if(e){n.msg("SKU启用之后不能添加或者修改业务信息",{icon:5});return}f=t.checkStatus(u.config.id);switch(u.event){case"add":n.open({type:2,title:"添加SKU业务控制信息",content:"/Pay/ProductSku/AddBusiness?iframeName="+window.name+"&id="+r,skin:"layui-layer-lan",area:["900px","420px"],offset:"auto",shade:.3,maxmin:!0,end:function(){t.reload("tableBusiness")}});break;case"delete":if(f.data.length!==1){n.msg("请先选择有且仅有一个SKU业务控制信息");return}o=f.data[0].businessCtrlType;n.confirm("您确定要删除当条业务信息吗?",{icon:3,title:"提示"},function(u){i.post("/Pay/ProductSku/DeleteBusiness",{skuId:r,businessCtrlType:o},function(i){return i.success?(n.msg("操作成功"),t.reload("tableBusiness"),n.close(u),!1):(n.alert("操作失败:"+i.msg,{title:"错误",icon:5}),!1)})})}})});