Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()},t;/(y+)/i.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};layui.use(["form","layer","table","laytpl","laydate"],function(){function e(){let n=new Date,t=new Date(n.getFullYear(),n.getMonth(),n.getDate()-7);return t.format("yyyy-MM-dd")+" ~ "+n.format("yyyy-MM-dd")}var o=layui.form,i=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery,s=layui.laytpl,r=layui.table,f=layui.laydate,t,u;if(f.render({elem:"#submitDateRange",range:"~",type:"date",min:-30,max:1,theme:"molv",calendar:!0}),t=top.initFilter(window),n("#submitDateRange").val().trim()===""){let t=e();n("#submitDateRange").val(t)}u=r.render({elem:"#table",method:"post",url:null,data:[],height:"full-"+t.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{field:"senderRecordId",title:"邮件主键",hide:!0},{field:"providerType",title:"发送渠道",width:150},{field:"title",title:"邮件标题"},{field:"typeInfo",title:"发送模板",width:200,templet:function(n){return n.businessEmailType==="None"?n.messageEmailType:n.businessEmailType}},{field:"from",title:"发件人",width:300},{field:"to",title:"收件人",width:250},{field:"messageId",title:"邮件提交标识",hide:!0},{field:"submitInfo",title:"提交信息",width:160,templet:function(n){return n.submitFailureStatus!=="成功"?n.submitTime+'<br/><p style="color:orange">'+n.submitFailureStatus+"<\/p>":n.submitTime+"<br/>"+n.submitFailureStatus}},{field:"deliveryInfo",title:"投递信息",width:160,templet:function(n){if(n.deliveryFailureStatus===""&&n.deliveryReportedTime===null)return"";let t="";return t=n.deliveryFailureStatus!=="成功"&&n.deliveryFailureStatus!==""?(n.deliveryReportedTime===null?"":n.deliveryReportedTime)+'<br/><p title="'+n.deliveryFailureMessage+'" style="color:orange">'+n.deliveryFailureStatus+"<\/p>":(n.deliveryReportedTime===null?"":n.deliveryReportedTime)+"<br/><p>"+n.deliveryFailureStatus+"<\/p>",n.deliveryFailureStatus!==""&&n.messageId!==""&&(t+='<a class="layui-table-link" lay-event="detail">投递详情<\/a>'),t}},{field:"deliveryFailureMessage",title:"投递信息报告",hide:!0},{field:"businessInfo",title:"业务信息",width:230,templet:function(n){return n.businessNotifyConfirmed==="否"&&n.businessEmailType!=="None"?"业务状态: "+n.businessEmailFailureStatus+'<br/><p style="color:orange">业务确认: '+n.businessNotifyConfirmed+"<p>确认时间: "+(n.businessNotifyConfirmTime===null?"":n.businessNotifyConfirmTime):n.businessNotifyConfirmed==="否"&&n.businessEmailType==="None"?"业务状态: "+n.businessEmailFailureStatus+"<br/>业务确认: 不需确认<br/>确认时间: "+(n.businessNotifyConfirmTime===null?"":n.businessNotifyConfirmTime):"业务状态: "+n.businessEmailFailureStatus+"<br/>业务确认: "+n.businessNotifyConfirmed+"<br/>确认时间: "+(n.businessNotifyConfirmTime===null?"":n.businessNotifyConfirmTime)}}]],parseData:function(n){return n.success?n:{code:0,msg:n.msg,count:0,data:[],success:!1}},page:{limit:t.limit?t.limit:10,limits:[10,15,20,25],curr:t.page?t.page:1},where:{submitDateRange:t.submitDateRange,to:t.to,from:t.from},done:function(t,r){n("#page").val(r);n("#limit").val(this.limit);top.changeUrlParam(window);t&&t.success!==undefined&&!t.success&&i.alert("操作失败:"+t.msg,{title:"错误",icon:5})}});r.on("tool(table)",function(n){let t=n.data.messageId;switch(n.event){case"detail":i.open({type:2,title:"投递详情 "+t,content:"/Business/Email/Detail?messageId="+t,skin:"layui-layer-lan",area:["800px","580px"],offset:"auto",shade:.3})}});n("#search").on("click",function(){var f,t,e;if(n.trim(n("#to").val()).length<=0||n.trim(n("#submitDateRange").val()).length<=0)return i.alert("操作失败:搜索参数必须包含提交时间段和收件人邮箱",{title:"错误",icon:5}),!1;f=n("form").serialize().split("&");t={};for(e in f)f.hasOwnProperty(e)&&(t[f[e].split("=")[0]]=decodeURIComponent(f[e].split("=")[1]));return t.submitDateRange=t.submitDateRange.replace(/\+/g,""),u.config.url="/Business/Email/GetEmailPageData",r.reload("table",{page:{curr:1},where:{submitDateRange:t.submitDateRange,to:t.to,from:t.from}}),!0});n.trim(n("#submitDateRange").val()).length>0&&n.trim(n("#to").val()).length>0&&n("#search").click()});