layui.use(["form","layer","table","laytpl"],function(){var f=layui.form,t=parent.layer===undefined?layui.layer:top.layer,n=layui.jquery,e=layui.laytpl,r=layui.table,i=top.initFilter(window),u=r.render({elem:"#table",method:"post",url:null,data:[],height:"full-"+i.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{field:"userId",title:"用户ID",width:180},{field:"userRole",title:"角色",width:120},{field:"nodeId",title:"节点",hide:!0},{field:"dbNo",title:"数据库编号",hide:!0},{field:"nickName",title:"昵称"},{field:"email",title:"邮箱"},{field:"source",title:"来源"},{field:"state",title:"状态",width:70},{field:"lastSignIn",title:"最后登录时间",width:160},{field:"createTime",title:"创建时间",width:160},{field:"language",title:"语言",width:70},{field:"country",title:"国家",width:120},{field:"isPay",title:"是否付费",hide:!0},{field:"source",title:"来源",hide:!0},{field:"operation",title:"操作",toolbar:"#operationBar",width:120,minWidth:120}]],parseData:function(n){return n.success?n:{code:0,msg:n.msg,count:0,data:[],success:!1}},page:{limit:i.limit?i.limit:10,limits:[10,15,20,25],curr:i.page?i.page:1},where:{userId:i.userId,email:i.email},done:function(i,r){n("#page").val(r);n("#limit").val(this.limit);top.changeUrlParam(window);i&&i.success!==undefined&&!i.success&&t.alert("操作失败:"+i.msg,{title:"错误",icon:5})}});r.on("tool(table)",function(i){var u=i.data,e=i.event,s=i.tr,f,r;let o=u.userId;e==="detail"&&(f=JSON.parse(window.top.sessionStorage.getItem("curmenu")),window.top.addMyTab("/business/user/detail?userId="+o,"注册用户 "+u.email,f.topMenuName,f.leftMenuName));e==="delete"&&(r=!0,t.prompt({formType:0,title:'请输入要注销用户"'+u.nickName+'"的注册邮箱：'},function(i,f){if(r)r=!1;else return!1;if(i!=u.email)return t.alert("操作失败:输入的邮箱不正确",{title:"错误",icon:5}),r=!0,!1;n.post("/Business/User/DeleteUser",{userId:o,email:i},function(i){i.success?(t.alert("操作成功",{icon:6}),t.close(f),n("#search").click()):(t.alert("操作失败:"+i.msg,{title:"错误",icon:5}),r=!0)})}))});n("#search").on("click",function(){var i,f,e;if(n.trim(n("#userId").val()).length<=0&&n.trim(n("#email").val()).length<=0&&n.trim(n("#gid").val()).length<=0)return t.alert("操作失败:搜索参数至少包含UserId(Gid)或者Email其一",{title:"错误",icon:5}),!1;i=n("form").serialize().split("&");f={};for(e in i)i.hasOwnProperty(e)&&(f[i[e].split("=")[0]]=decodeURIComponent(i[e].split("=")[1]));return u.config.url="/Business/User/GetUserPageData",r.reload("table",{page:{curr:1},where:{userId:f.userId,email:f.email}}),!0});(n.trim(n("#userId").val()).length>0||n.trim(n("#email").val()).length>0)&&n("#search").click()});