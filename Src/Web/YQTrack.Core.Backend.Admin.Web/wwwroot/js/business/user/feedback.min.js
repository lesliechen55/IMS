layui.use(["form","layer","table","laytpl"],function(){var u=layui.form,t=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,f=layui.laytpl,r=layui.table,n=top.initFilter(window);r.render({elem:"#table",method:"post",url:"/Business/User/GetUserFeedbackPageData",height:"full-"+n.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"checkbox"},{field:"feedbackId",title:"反馈ID",hide:!0},{field:"createTime",title:"反馈时间",width:160},{field:"userId",title:"用户ID",width:180},{field:"email",title:"邮箱"},{field:"feedback",title:"内容"},{field:"state",title:"状态",width:80},{field:"replyTime",title:"回复时间",width:160},{field:"replyContent",title:"回复内容"},{field:"replyUserId",title:"回复人",width:180}]],parseData:function(n){return n.success?n:{code:0,msg:n.msg,count:0,data:[],success:!1}},page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{userId:n.userId,email:n.email,content:n.content},done:function(n,r){i("#page").val(r);i("#limit").val(this.limit);top.changeUrlParam(window);n.success||t.alert("操作失败:"+n.msg,{title:"错误",icon:5})}});r.on("toolbar(table)",function(n){var f=r.checkStatus(n.config.id),i,u;if(f.data.length<1){t.msg("请先选择需要回复的反馈意见");return}if(i=[],u=!1,f.data.forEach(function(n){if(n.state=="已回复"){u=!0;return}i.push(n.feedbackId)}),u){t.msg("选中的项包含已经处理过的反馈信息！");return}switch(n.event){case"reply":t.open({type:2,title:"回复用户反馈信息：",content:"/Business/User/Reply?iframeName="+window.name+"&feedBackIds="+i.join(","),skin:"layui-layer-lan",area:["500px","300px"],offset:"auto",shade:.3,maxmin:!0})}});i("#search").on("click",function(){var n=i("form").serialize().split("&"),t={};for(var u in n)n.hasOwnProperty(u)&&(t[n[u].split("=")[0]]=decodeURIComponent(n[u].split("=")[1]));return r.reload("table",{page:{curr:1},where:{userId:t.userId,email:t.email,content:t.content}}),!0})});