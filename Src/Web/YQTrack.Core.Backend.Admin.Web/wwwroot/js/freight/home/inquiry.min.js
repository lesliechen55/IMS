layui.use(["laydate","form","layer","table","laytpl"],function(){function f(n,i,r,u){t.open({type:2,shade:.3,title:"下架-询价单号: "+n,skin:"layui-layer-lan",area:["500px","360px"],content:"/Freight/InquiryManage/Index?orderId="+i+"&sourceIframeName="+r+"&invokeElementId="+u})}var e=layui.form,t=parent.layer===undefined?layui.layer:top.layer,i=layui.jquery,o=layui.laytpl,r=layui.table,n=top.initFilter(window),u=layui.laydate;u.render({elem:"#publishStartTime",type:"date",format:"yyyy-MM-dd",min:"2018-1-1",max:"2025-12-31",lang:"cn",theme:"molv",calendar:!0});u.render({elem:"#publishEndTime",type:"date",format:"yyyy-MM-dd",min:"2018-1-1",max:"2025-12-31",lang:"cn",theme:"molv",calendar:!0});u.render({elem:"#expireStartTime",type:"date",format:"yyyy-MM-dd",min:"2018-1-1",max:"2025-12-31",lang:"cn",theme:"molv",calendar:!0});u.render({elem:"#expireEndTime",type:"date",format:"yyyy-MM-dd",min:"2018-1-1",max:"2025-12-31",lang:"cn",theme:"molv",calendar:!0});r.render({elem:"#table",method:"post",url:"/Freight/Home/GetInquiryList/",height:"full-"+n.top,cellMinWidth:60,toolbar:"#toolbar",defaultToolbar:["filter","exports","print"],cols:[[{type:"numbers"},{type:"radio"},{field:"id",title:"询价单ID",templet:'<div><a target="_blank" href="https://freight.17track.net/en/inqury-detail/{{d.id}}" class="layui-table-link">{{d.id}}<\/a><\/div>'},{field:"title",title:"标题"},{field:"inquiryNo",title:"询价单号",minWidth:170},{field:"userId",title:"用户ID"},{field:"userUniqueId",title:"用户短标识"},{field:"packageCity",title:"揽件城市"},{field:"deliveryCountry",title:"派送国家"},{field:"publishDateTime",title:"发布时间",minWidth:170},{field:"status",title:"审核状态"},{field:"statusTime",title:"状态变更时间"},{field:"processTime",title:"处理时间"},{field:"LogisticsRequire",title:"物流要求"},{field:"contactInfo",title:"联系人信息"},{field:"quoterCount",title:"报价数量"},{field:"viewerCount",title:"浏览次数"},{field:"expireDate",title:"截止时间",minWidth:170}]],parseData:function(n){return n.success?n:{code:0,msg:n.msg,count:0,data:[]}},page:{limit:n.limit?n.limit:10,limits:[10,15,20,25],curr:n.page?n.page:1},where:{id:n.id,title:n.title,inquiryNo:n.inquiryNo,status:n.status,publisher:n.publisher,publishStartTime:n.publishStartTime,publishEndTime:n.publishEndTime,expireStartTime:n.expireStartTime,expireEndTime:n.expireEndTime},done:function(n,r){i("#page").val(r);i("#limit").val(this.limit);top.changeUrlParam(window);n.success||t.alert("操作失败:"+n.msg,{title:"错误",icon:5})}});r.on("toolbar(inquiryTable)",function(n){var u=r.checkStatus(n.config.id),i;if(n.event==="reject"){if(u.data.length!==1){t.msg("请先选择有且仅有一个询价单");return}if(i=u.data[0],i.status==="交易失败"||i.status==="管理员下架"){t.msg("交易失败或者管理员下架状态,不能下架!!!");return}if(i.status==="交易成功"){t.confirm('此询价单处于"交易成功"状态,是否继续下架?',{icon:3,title:"提示"},function(n){f(i.inquiryNo,i.id,window.name,"search");t.close(n)});return}f(i.inquiryNo,i.id,window.name,"search")}});i("#search").on("click",function(){var t=i("form").serialize().split("&"),n={};for(var u in t)t.hasOwnProperty(u)&&(n[t[u].split("=")[0]]=decodeURIComponent(t[u].split("=")[1]));r.reload("table",{page:{curr:1},where:{id:n.id,title:n.title,inquiryNo:n.inquiryNo,status:n.status,publisher:n.publisher,publishStartTime:n.publishStartTime,publishEndTime:n.publishEndTime,expireStartTime:n.expireStartTime,expireEndTime:n.expireEndTime}})});i("#export").on("click",function(){var n=i(this).prop("href")+"?",r=i("form").serialize().split("&");for(var u in r)r.hasOwnProperty(u)&&(n=n+r[u].split("=")[0]+"="+decodeURIComponent(r[u].split("=")[1]),n=n+"&");return n=n.slice(0,-1),i.fileDownload(n).done(function(){t.msg("文件下载成功请保存到您的电脑上面!",{icon:1})}).fail(function(n){t.open({title:"文件下载失败",content:n})}),!1})});